name: Issue Metrics
on:
  schedule:
    - cron: "0 0 * * 1" # ë§¤ì£¼ ì›”ìš”ì¼
  workflow_dispatch:

jobs:
  metrics:
    runs-on: ubuntu-latest
    steps:
      - name: Calculate metrics
        uses: actions/github-script@v6
        with:
          script: |
            const { data: issues } = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'all',
              since: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString()
            });

            const metrics = {
              totalIssues: issues.length,
              openIssues: issues.filter(i => i.state === 'open').length,
              closedIssues: issues.filter(i => i.state === 'closed').length,
              bugIssues: issues.filter(i => i.labels.some(l => l.name.includes('bug'))).length,
              featureIssues: issues.filter(i => i.labels.some(l => l.name.includes('feature'))).length
            };

            console.log('ğŸ“Š ì£¼ê°„ ì´ìŠˆ ë©”íŠ¸ë¦­:');
            console.log(`- ì „ì²´ ì´ìŠˆ: ${metrics.totalIssues}`);
            console.log(`- ì—´ë¦° ì´ìŠˆ: ${metrics.openIssues}`);
            console.log(`- ë‹«íŒ ì´ìŠˆ: ${metrics.closedIssues}`);
            console.log(`- ë²„ê·¸: ${metrics.bugIssues}`);
            console.log(`- ìƒˆê¸°ëŠ¥: ${metrics.featureIssues}`);
